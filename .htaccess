<IfModule mod_rewrite.c>
RewriteEngine On

# Serve WebP if browser supports it and file exists
RewriteCond %{HTTP_ACCEPT} image/webp
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_FILENAME} \.webp$
RewriteRule ^(.+)\.webp$ $1.webp [T=image/webp,L]

# Fallback: If WebP file doesn't exist, try JPG
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} \.webp$
RewriteRule ^(.+)\.webp$ $1.jpg [L]

# Fallback: If JPG doesn't exist, try PNG
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} \.webp$
RewriteRule ^(.+)\.webp$ $1.png [L]
</IfModule>

# Serve correct MIME types
<IfModule mod_mime.c>
AddType image/webp .webp
AddType image/jpeg .jpg .jpeg
AddType image/png .png
</IfModule>
